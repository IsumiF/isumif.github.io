<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>My Hakyll Blog - Introduction to Full Stack Haskell Web Development</title>
        <link rel="stylesheet" href="../../../css/default.css" />
        <link rel="stylesheet" href="../../../css/syntax.css" />
    </head>
    <body>
        <header>
            <div class="logo">
                <a href="../../../">My Hakyll Blog</a>
            </div>
            <nav>
                <a href="../../../">Home</a>
                <a href="../../../about.html">About</a>
                <a href="../../../contact.html">Contact</a>
                <a href="../../../archive.html">Archive</a>
            </nav>
        </header>

        <main role="main">
            <h1>Introduction to Full Stack Haskell Web Development</h1>
            <article>
    <section class="header">
        Posted on October 26, 2017
        
    </section>
    <section>
        <p>Here we introduce a haskell full-stack web development solution.</p>
<p>Our servers do not directly generate HTML pages. Instead, they provide JSON APIs. Client code should call those APIs to acheive functionality. In web pages, JS code render the pages using server-provided APIs. This is one of the easiest way to build highly interactive web pages.</p>
<h2 id="ghcjs">GHCJS</h2>
<p>JavaScript has too many problems. Thanks to GHCJS, we can write in haskell, then compile it down to JavaScript. We will use <code>stack</code> in this tutorial.</p>
<p>Client-side code should have its own stack.yaml. Unlike common applications and libraries, we don’t have a <code>stack.yaml</code> at project root. We need at least 3 sub directories:</p>
<ul>
<li>client - contains a <code>stack.yaml</code></li>
<li>common - a cabal package, referenced in both client and server</li>
<li>server - contains a <code>stack.yaml</code></li>
</ul>
<p>Now let’s focus on client-side code.</p>
<ol style="list-style-type: decimal">
<li>Install a recent version of Node.js</li>
<li><code>stack new</code> or directly create the project by hand. We need to tell stack to <a href="https://docs.haskellstack.org/en/stable/ghcjs/">use GHSJS over regular GHC</a></li>
<li>Run <code>stack setup</code>. It will take 30 minutes or more, as <code>stack</code> compiles GHCJS from source in this stage.</li>
<li>Add <code>miso</code> as a dependency in cabal file, copy <a href="https://github.com/dmjio/miso#sample-application">Sample Application</a> into your <code>Main.hs</code></li>
<li>Try <code>stack build</code>, then you probably need to use <code>stack solver</code> to add <code>miso</code> to your <code>extra-deps</code>. A few JS files will be generated in <code>$(stack path --local-install-root)/bin/EXECUTABLE.jsexe/all.js</code>, where <code>EXECUTABLE</code> is the executable name configured in your cabal file.</li>
<li>Open <code>index.html</code> in your browser, you should see a working client-side application.</li>
</ol>
<p>During development, we prefer GHCJSi, an interactive environment like GHCi.</p>
<ol style="list-style-type: decimal">
<li>Add <code>maini = clearBody &gt;&gt; main</code> to your <code>Main.hs</code>. Import <code>Miso.Dev</code> if you didn’t.</li>
<li>Run <code>npm install socket.io</code> in your <code>client</code> project root. <code>socket.io</code> is needed by GHCJSi to interact with the browser.</li>
<li>Run <code>export NODE_PATH=$(pwd)/node_modules</code></li>
<li>Use <code>stack ghci</code> to start GHCJSi. You should see something like <code>socket.io found, browser session available at http://localhost:6400</code> in your GHCJSi session.</li>
<li>Open a browser, navigate to <code>http://localhost:6400</code></li>
<li>Run <code>maini</code> in GHCJSi, you should see your application in the browser.</li>
</ol>
<p><strong>IMPORTANT:</strong> You must open the browser and navigate to that web page <strong>BEFORE</strong> running <code>maini</code> in GHCJSi. Otherwise, strange error message may arise.</p>
    </section>
</article>

        </main>

        <footer>
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </footer>
    </body>
</html>
